-- ============================================================================
-- Manual ingestion of Digital Health workflows
-- Usage (psql):
--   \i database/sql/workflows-dh-seeds/seed_workflows.sql
-- Update the tenant slug below before running.
-- ============================================================================

BEGIN;

DO $$
DECLARE
  v_tenant_id uuid;
BEGIN
  SELECT id INTO v_tenant_id
  FROM tenants
  WHERE slug = 'platform'
  LIMIT 1;

  IF v_tenant_id IS NULL THEN
    INSERT INTO tenants (slug, name, type, status)
    VALUES ('platform', 'Platform Tenant', 'platform', 'active')
    ON CONFLICT (slug) DO UPDATE SET name = EXCLUDED.name
    RETURNING id INTO v_tenant_id;
  END IF;

  PERFORM set_config('app.tenant_id', v_tenant_id::text, true);
END;
$$;

SELECT dh_ingest_workflow_by_slug('platform', $$
{ "domain": "Clinical Development", "use_case": { "code": "UC_CD_001", "title": "DTx Clinical Endpoint Selection & Validation", "summary": "Systematic process for selecting and validating clinical endpoints for digital therapeutics trials, ensuring regulatory acceptability, clinical meaningfulness, and patient-centered design.", "complexity": "Expert", "workflows": [ { "name": "Endpoint Selection & Validation Workflow", "description": "End-to-end workflow guiding teams through context definition, precedent research, endpoint identification, validation, and final regulatory alignment.", "tasks": [ { "code": "T1.1", "title": "Define Clinical Context", "objective": "Establish a shared understanding of the clinical problem, mechanism of action, and target population.", "agents": ["P01_CMO", "P10_PATADV"], "tools": ["Literature DB", "Clinical Context Template"], "dependencies": [], "inputs": ["DTx Product Description", "Indication Summary"], "outputs": ["Clinical Context Document"], "prompts": [ { "name": "Clinical_Context_Definition", "pattern": "CoT", "system_prompt": "You are a Chief Medical Officer defining the clinical context for a new digital therapeutic.", "user_template": "Describe the clinical problem, target population, mechanism of action, and unmet need for {product_name} in {indication}. Include standard of care and patient impact." } ], "kpis": { "Completeness (%)": 100, "Stakeholder Alignment (%)": 90 } }, { "code": "T1.2", "title": "Identify Patient-Centered Outcomes", "objective": "Capture and prioritize outcomes that matter most to patients to inform endpoint design.", "agents": ["P10_PATADV", "P01_CMO"], "tools": ["Patient Interview Guide", "Outcome Prioritization Matrix"], "dependencies": ["T1.1"], "inputs": ["Clinical Context Document"], "outputs": ["Patient-Centered Outcomes Report"], "prompts": [ { "name": "Patient_Outcome_Prioritization", "pattern": "Few-Shot", "system_prompt": "You are a Patient Advocate summarizing what outcomes matter most to patients with this condition.", "user_template": "List and rank the top 5 patient outcomes for {target_condition}. Include why they matter, how they are experienced, and potential measurement methods." } ], "kpis": { "Patient Participation Rate (%)": 80, "Outcome Alignment Score": 4.5 } }, { "code": "T2.1", "title": "Research Regulatory Precedent", "objective": "Identify and analyze FDA-cleared endpoints used in similar DTx indications.", "agents": ["P02_VPCLIN", "P05_REGDIR"], "tools": ["FDA De Novo Database", "Internal Regulatory Archive"], "dependencies": ["T1.2"], "inputs": ["Clinical Context Document", "Patient-Centered Outcomes Report"], "outputs": ["Regulatory Precedent Analysis"], "prompts": [ { "name": "DTx_Precedent_Analysis", "pattern": "RAG", "system_prompt": "You are a VP Clinical Development expert at analyzing FDA precedent.", "user_template": "Search FDA databases for DTx with similar {indication} or {mechanism}. Summarize their primary endpoints, instruments, comparators, and acceptance status." } ], "kpis": { "Number of Precedents Found": 5, "Analysis Quality Score": 4.8 } }, { "code": "T2.2", "title": "Review FDA Guidance", "objective": "Summarize key regulatory expectations for endpoint validation and documentation.", "agents": ["P05_REGDIR"], "tools": ["FDA Guidance Library"], "dependencies": ["T2.1"], "inputs": ["Regulatory Precedent Analysis"], "outputs": ["FDA Guidance Summary"], "prompts": [ { "name": "FDA_Guidance_Review", "pattern": "RAG", "system_prompt": "You are a Regulatory Affairs Director extracting key points from FDA endpoint guidance.", "user_template": "Summarize endpoint selection principles, validation requirements, and risk mitigation from relevant FDA guidance documents for {indication}." } ], "kpis": { "Guidance Coverage (%)": 100 } }, { "code": "T3.1", "title": "Identify Primary Endpoint Candidates", "objective": "Generate and evaluate strong primary endpoint candidates based on precedent and feasibility.", "agents": ["P01_CMO", "P04_BIOSTAT"], "tools": ["Endpoint Evaluation Template"], "dependencies": ["T2.2"], "inputs": ["FDA Guidance Summary", "Patient-Centered Outcomes Report"], "outputs": ["Primary Endpoint Candidate Analysis"], "prompts": [ { "name": "Primary_Endpoint_Identification", "pattern": "CoT", "system_prompt": "You are a CMO selecting primary endpoints for a DTx clinical trial.", "user_template": "List and evaluate possible endpoints for {indication}, scoring each for regulatory precedent, clinical meaningfulness, psychometric strength, and patient burden." } ], "kpis": { "Number of Candidates": 3, "Feasibility Score": 4.2 } }, { "code": "T3.2", "title": "Develop Secondary Endpoint Package", "objective": "Select secondary endpoints to support regulatory and commercial goals.", "agents": ["P01_CMO", "P02_VPCLIN"], "tools": ["Commercial Value Matrix"], "dependencies": ["T3.1"], "inputs": ["Primary Endpoint Candidate Analysis"], "outputs": ["Secondary Endpoint Strategy"], "prompts": [ { "name": "Secondary_Endpoint_Package", "pattern": "Few-Shot", "system_prompt": "You are a Clinical Strategist creating a balanced secondary endpoint package.", "user_template": "Based on {primary_endpoints}, recommend 3-5 secondary endpoints supporting commercial and regulatory claims. Include purpose and measurement frequency." } ], "kpis": { "Endpoint Diversity Index": 0.8 } }, { "code": "T4.1", "title": "Assess Psychometric Properties", "objective": "Evaluate reliability, validity, and responsiveness for each candidate endpoint.", "agents": ["P04_BIOSTAT"], "tools": ["PubMed", "Psychometric Database"], "dependencies": ["T3.2"], "inputs": ["Primary Endpoint Candidate Analysis"], "outputs": ["Psychometric Assessment Report"], "prompts": [ { "name": "Psychometric_Evaluation", "pattern": "CoT", "system_prompt": "You are a biostatistician evaluating psychometric properties.", "user_template": "For each {endpoint}, summarize reliability (alpha), validity (construct, criterion), responsiveness, and MCID. Rate overall psychometric strength (1-5)." } ], "kpis": { "Endpoints with Strong Psychometrics (%)": 80 } }, { "code": "T4.2", "title": "Evaluate Digital Feasibility", "objective": "Confirm digital collection feasibility, data quality, and technical burden.", "agents": ["P06_PMDIG"], "tools": ["Platform Capability Matrix"], "dependencies": ["T4.1"], "inputs": ["Psychometric Assessment Report"], "outputs": ["Digital Feasibility Analysis"], "prompts": [ { "name": "Digital_Feasibility_Assessment", "pattern": "Few-Shot", "system_prompt": "You are a Product Manager assessing digital feasibility for clinical endpoints.", "user_template": "For each {endpoint}, assess feasibility of digital data capture, estimated development effort, and expected completion rate." } ], "kpis": { "Endpoints Rated Feasible (%)": 85 } }, { "code": "T4.3", "title": "Evaluate Patient Burden", "objective": "Calculate and assess patient time and cognitive burden for all assessments.", "agents": ["P10_PATADV", "P06_PMDIG"], "tools": ["Assessment Burden Calculator"], "dependencies": ["T4.2"], "inputs": ["Endpoint Candidate List", "Digital Feasibility Analysis"], "outputs": ["Patient Burden Report"], "prompts": [ { "name": "Patient_Burden_Estimator", "pattern": "CoT", "system_prompt": "You are a patient advocate assessing endpoint burden.", "user_template": "Compute total assessment time for all {endpoints}. Identify high-burden measures (>15 min) and propose burden-reduction options." } ], "kpis": { "Average Burden (min)": 12 } }, { "code": "T5.1", "title": "Regulatory Risk Assessment", "objective": "Evaluate acceptance likelihood and mitigation strategies for each endpoint.", "agents": ["P05_REGDIR", "P01_CMO"], "tools": ["Regulatory Risk Matrix"], "dependencies": ["T4.3"], "inputs": ["Psychometric Assessment Report", "Patient Burden Report"], "outputs": ["Regulatory Risk Assessment Plan"], "prompts": [ { "name": "Regulatory_Risk_Assessment", "pattern": "CoT", "system_prompt": "You are a Regulatory Affairs Director performing endpoint risk analysis.", "user_template": "For each {endpoint}, assess FDA acceptance likelihood, risks, mitigation plans, and backup strategies." } ], "kpis": { "Endpoints with Acceptable Risk (%)": 90 } }, { "code": "T5.2", "title": "Final Recommendation & Stakeholder Alignment", "objective": "Synthesize all evidence and finalize endpoint strategy for FDA submission.", "agents": ["P01_CMO", "P05_REGDIR", "P10_PATADV", "P04_BIOSTAT"], "tools": ["Endpoint Decision Matrix", "Executive Deck Template"], "dependencies": ["T5.1"], "inputs": ["Regulatory Risk Assessment Plan"], "outputs": ["Final Endpoint Selection Report", "Executive Summary", "Stakeholder Presentation Deck"], "prompts": [ { "name": "Decision_Matrix_Creation", "pattern": "CoT", "system_prompt": "You are a CMO finalizing endpoint recommendations.", "user_template": "Compare all endpoints across criteria (regulatory confidence, psychometric strength, patient burden, feasibility) and recommend primary and secondary endpoints." } ], "kpis": { "Decision Consensus (%)": 100 } } ] } ] }
$$::jsonb);

SELECT dh_ingest_workflow_by_slug('platform', $$
{ "domain": "Clinical Development", "use_case": { "code": "UC_CD_002", "title": "Digital Biomarker Validation Strategy (DiMe V3 Framework)", "summary": "Structured validation of digital biomarkers following the DiMe V3 frameworkâ€”Verification, Analytical Validation, and Clinical Validationâ€”to establish regulatory-grade digital endpoints for clinical trials.", "complexity": "Expert", "workflows": [ { "name": "Digital Biomarker Validation Workflow", "description": "Nine-step end-to-end workflow to design, execute, and document V1-V3 validation studies aligned with FDA and DiMe V3 guidance.", "tasks": [ { "code": "T1", "title": "Define Intended Use & Context of Use", "objective": "Clarify the digital biomarker's clinical construct, target population, endpoint classification, and regulatory pathway.", "agents": ["P06_DTXCMO", "P04_REGDIR"], "tools": ["Intended Use Template", "PICO Framework", "Regulatory Strategy Matrix"], "dependencies": [], "inputs": ["Digital Biomarker Concept Note"], "outputs": ["Intended Use & Context of Use Document"], "prompts": [ { "name": "Biomarker_Intended_Use", "pattern": "CoT", "system_prompt": "You are a DTx Chief Medical Officer defining intended use for a novel digital biomarker.", "user_template": "Describe the {biomarker_name}, what it measures, the patient population, endpoint type, and regulatory strategy using the PICO structure." } ], "kpis": { "Completeness (%)": 100, "Stakeholder Alignment (%)": 95 } }, { "code": "T2", "title": "Design Verification Study (V1)", "objective": "Plan accuracy, precision, and data-quality verification comparing the digital measure to a gold standard.", "agents": ["P07_DATASC"], "tools": ["Verification Protocol Template", "Statistical Power Calculator"], "dependencies": ["T1"], "inputs": ["Intended Use & Context of Use Document"], "outputs": ["Verification Study Protocol (V1)"], "prompts": [ { "name": "Verification_Study_Design", "pattern": "CoT", "system_prompt": "You are a Data Scientist designing a technical verification study.", "user_template": "Outline accuracy, precision, and robustness tests for {biomarker_name} versus {gold_standard}. Define sample size, analysis metrics (ICC, Bland-Altman), and success criteria." } ], "kpis": { "Protocol Approval (%)": 100 } }, { "code": "T3", "title": "Execute Verification & Analysis (V1)", "objective": "Collect data, perform statistical analyses (ICC, Bland-Altman, correlation), and document verification outcomes.", "agents": ["P07_DATASC"], "tools": ["Python", "R", "Bland-Altman Toolkit"], "dependencies": ["T2"], "inputs": ["Verification Study Protocol (V1)"], "outputs": ["Verification Report (V1)"], "prompts": [ { "name": "Verification_Data_Analysis", "pattern": "Code-Assist", "system_prompt": "You are a data scientist analyzing digital vs. gold-standard data.", "user_template": "Compute ICC, bias, limits of agreement, and data-quality metrics for {biomarker_name}. Summarize pass/fail results versus targets (ICC > 0.85, missing < 10%)." } ], "kpis": { "ICC Accuracy": 0.9, "Missing Data (%)": 5 } }, { "code": "T4", "title": "Design Analytical Validation Study (V2)", "objective": "Design construct, convergent, divergent, and known-groups validity analyses for the biomarker.", "agents": ["P08_CLINRES"], "tools": ["Analytical Validation Protocol Template"], "dependencies": ["T3"], "inputs": ["Verification Report (V1)"], "outputs": ["Analytical Validation Protocol (V2)"], "prompts": [ { "name": "Analytical_Validation_Design", "pattern": "CoT", "system_prompt": "You are a Clinical Research Scientist designing analytical validation.", "user_template": "Define study design, validity hypotheses, comparator measures, and statistical thresholds (e.g., convergent r > 0.6, divergent < 0.3) for {biomarker_name}." } ], "kpis": { "Protocol Approval (%)": 100 } }, { "code": "T5", "title": "Execute Analytical Validation (V2)", "objective": "Perform statistical analyses (convergent, divergent, known-groups) and interpret construct validity.", "agents": ["P08_CLINRES", "P07_DATASC"], "tools": ["R", "Python", "Validity Analysis Toolkit"], "dependencies": ["T4"], "inputs": ["Analytical Validation Protocol (V2)"], "outputs": ["Analytical Validation Report (V2)"], "prompts": [ { "name": "Analytical_Validation_Analysis", "pattern": "CoT", "system_prompt": "You are analyzing analytical validation data for a digital biomarker.", "user_template": "Assess convergent validity against {comparator}, divergent validity against {unrelated_measure}, and known-groups differences. Summarize statistical significance and effect sizes." } ], "kpis": { "Convergent Validity (r)": 0.65, "Known-Groups Effect Size": 0.8 } }, { "code": "T6", "title": "Design Clinical Validation Study (V3)", "objective": "Plan prospective clinical validation linking biomarker to clinical outcomes and treatment response.", "agents": ["P08_CLINRES", "P06_DTXCMO"], "tools": ["Clinical Validation Protocol Template", "Sample Size Calculator"], "dependencies": ["T5"], "inputs": ["Analytical Validation Report (V2)"], "outputs": ["Clinical Validation Protocol (V3)"], "prompts": [ { "name": "Clinical_Validation_Design", "pattern": "CoT", "system_prompt": "You are a Clinical Research Scientist designing a V3 clinical validation study.", "user_template": "Define outcomes, study design, duration, and statistical methods to assess association of {biomarker_name} with clinical endpoints and establish MCID." } ], "kpis": { "Protocol Finalized (%)": 100 } }, { "code": "T7", "title": "Execute Clinical Validation & MCID Determination", "objective": "Conduct V3 clinical study, analyze associations, and determine MCID using anchor- and distribution-based methods.", "agents": ["P08_CLINRES", "P15_HEOR"], "tools": ["R", "SAS", "Anchor-Based MCID Toolkit"], "dependencies": ["T6"], "inputs": ["Clinical Validation Protocol (V3)"], "outputs": ["Clinical Validation Report (V3)", "MCID Determination Summary"], "prompts": [ { "name": "Clinical_Validation_Analysis", "pattern": "CoT", "system_prompt": "You are an Outcomes Research Scientist analyzing clinical validation data.", "user_template": "Assess correlation with clinical outcomes (p < 0.05), treatment responsiveness, and compute MCID using anchor-based and distribution-based methods." } ], "kpis": { "p-Value": 0.05, "MCID Established": true } }, { "code": "T8", "title": "Regulatory Strategy & Pre-Submission", "objective": "Develop regulatory plan and conduct FDA Pre-Submission meeting for validation acceptance.", "agents": ["P04_REGDIR", "P06_DTXCMO"], "tools": ["FDA Pre-Sub Template", "Validation Summary Deck"], "dependencies": ["T7"], "inputs": ["Clinical Validation Report (V3)", "MCID Determination Summary"], "outputs": ["FDA Pre-Submission Package", "Meeting Minutes"], "prompts": [ { "name": "Regulatory_PreSub_Plan", "pattern": "RAG", "system_prompt": "You are a Regulatory Affairs Director preparing an FDA Pre-Submission.", "user_template": "Draft FDA Pre-Sub questions on validation sufficiency, comparator adequacy, and endpoint acceptability. Summarize feedback plan." } ], "kpis": { "FDA Feedback Positive (%)": 90 } }, { "code": "T9", "title": "Validation Report & Publication", "objective": "Consolidate all validation reports, prepare peer-reviewed manuscript, and disseminate findings.", "agents": ["P16_MEDWRIT", "P08_CLINRES"], "tools": ["Publication Template", "ICMJE Checklist"], "dependencies": ["T8"], "inputs": ["Verification Report (V1)", "Analytical Validation Report (V2)", "Clinical Validation Report (V3)"], "outputs": ["Comprehensive Validation Report", "Peer-Reviewed Manuscript"], "prompts": [ { "name": "Validation_Report_Publication", "pattern": "Few-Shot", "system_prompt": "You are a Medical Writer preparing the final validation report and manuscript.", "user_template": "Summarize methods and results from V1-V3, align with DiMe V3 framework, and draft manuscript for npj Digital Medicine or JMIR Digital Health." } ], "kpis": { "Publication Submitted": true, "Impact Factor Target": 5 } } ] } ] }
$$::jsonb);

COMMIT;
