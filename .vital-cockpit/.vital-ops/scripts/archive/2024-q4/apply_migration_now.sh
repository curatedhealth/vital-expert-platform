#!/bin/bash
#
# Quick Schema Migration Application
# This script helps you apply the schema migration needed for JTBD mappings
#

echo ""
echo "ğŸ”§ Schema Migration Required"
echo "======================================================================"
echo ""
echo "The jtbd_org_persona_mapping table needs a schema update to support"
echo "Medical Affairs personas (which use persona_dh_id instead of persona_id)."
echo ""
echo "======================================================================"
echo "OPTION 1: Supabase Dashboard (Recommended - Takes 30 seconds)"
echo "======================================================================"
echo ""
echo "1. Open your Supabase dashboard: https://supabase.com/dashboard"
echo "2. Select your project"
echo "3. Click 'SQL Editor' in the left sidebar"
echo "4. Click 'New Query'"
echo "5. Copy and paste this SQL:"
echo ""
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
cat supabase/migrations/20251109224900_fix_jtbd_mapping_persona_id.sql | grep -v "^--" | grep -v "^$"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""
echo "6. Click 'Run' â–¶ï¸"
echo "7. Look for green success message"
echo ""
echo "======================================================================"
echo "OPTION 2: Supabase CLI"
echo "======================================================================"
echo ""
echo "cd \"$(pwd)\""
echo "supabase db push"
echo ""
echo "======================================================================"
echo "After Migration is Applied:"
echo "======================================================================"
echo ""
echo "Run this command to create JTBD mappings:"
echo "python3 scripts/import_ma_jtbd_and_sp_mappings.py"
echo ""
echo "This will create ~170 JTBD mappings for the 41 Medical Affairs personas."
echo ""
