{
  "version": "1.0.0",
  "lastUpdated": "2025-11-22T00:00:00Z",
  "database": {
    "name": "vital",
    "version": "15.4",
    "engine": "postgresql"
  },
  "proposedExtension": {
    "name": "pharma_role_enrichment",
    "version": "1.0.0",
    "description": "Pharmaceutical/biotech role metadata enrichment",
    "status": "proposed",
    "targetDate": "2025-11-25"
  },
  "existingTables": [
    {
      "name": "org_roles",
      "schemaFile": "database/tables/org_roles.json",
      "version": "1.0.0",
      "columns": 22,
      "junctionTables": [
        "org_role_responsibilities",
        "org_department_roles",
        "org_function_roles",
        "role_goals",
        "role_challenges",
        "role_motivations"
      ],
      "proposedChanges": {
        "newColumns": 15,
        "deprecatedColumns": 2,
        "newJunctionTables": 11
      }
    },
    {
      "name": "org_functions",
      "schemaFile": "database/tables/org_functions.json",
      "version": "1.0.0",
      "columns": 10,
      "recordCount": null
    },
    {
      "name": "org_departments",
      "schemaFile": "database/tables/org_departments.json",
      "version": "1.0.0",
      "columns": 15,
      "recordCount": null
    },
    {
      "name": "org_responsibilities",
      "schemaFile": "database/tables/org_responsibilities.json",
      "version": "1.0.0",
      "columns": 11,
      "recordCount": null
    }
  ],
  "proposedTables": [
    {
      "name": "skills",
      "type": "reference",
      "category": "pharma_enrichment",
      "description": "Master registry of skills required for pharmaceutical/biotech roles",
      "estimatedRows": 500,
      "columns": 11,
      "indexes": 4,
      "junctionTables": ["role_skills"],
      "pharmaSpecific": true
    },
    {
      "name": "certifications",
      "type": "reference",
      "category": "pharma_enrichment",
      "description": "Professional certifications and licenses for pharma roles",
      "estimatedRows": 50,
      "columns": 13,
      "indexes": 3,
      "junctionTables": ["role_certifications"],
      "pharmaSpecific": true
    },
    {
      "name": "competencies",
      "type": "reference",
      "category": "pharma_enrichment",
      "description": "Core competencies and behavioral indicators",
      "estimatedRows": 30,
      "columns": 10,
      "indexes": 3,
      "junctionTables": ["role_competencies"],
      "pharmaSpecific": false
    },
    {
      "name": "kpis",
      "type": "reference",
      "category": "pharma_enrichment",
      "description": "Key Performance Indicators for role success measurement",
      "estimatedRows": 50,
      "columns": 13,
      "indexes": 4,
      "junctionTables": ["role_kpis"],
      "pharmaSpecific": true
    },
    {
      "name": "training_programs",
      "type": "reference",
      "category": "pharma_enrichment",
      "description": "Required and recommended training programs",
      "estimatedRows": 100,
      "columns": 15,
      "indexes": 4,
      "junctionTables": ["role_training_programs"],
      "pharmaSpecific": true
    },
    {
      "name": "regulatory_requirements",
      "type": "reference",
      "category": "pharma_enrichment",
      "description": "Regulatory compliance requirements by role",
      "estimatedRows": 75,
      "columns": 12,
      "indexes": 4,
      "junctionTables": ["role_regulatory_requirements"],
      "pharmaSpecific": true
    },
    {
      "name": "systems",
      "type": "reference",
      "category": "pharma_enrichment",
      "description": "Software and systems used in roles",
      "estimatedRows": 50,
      "columns": 12,
      "indexes": 4,
      "junctionTables": ["role_systems"],
      "pharmaSpecific": true
    },
    {
      "name": "deliverables",
      "type": "reference",
      "category": "pharma_enrichment",
      "description": "Key deliverables and work products produced by roles",
      "estimatedRows": 100,
      "columns": 13,
      "indexes": 4,
      "junctionTables": ["role_deliverables"],
      "pharmaSpecific": true
    },
    {
      "name": "therapeutic_areas",
      "type": "reference",
      "category": "pharma_enrichment",
      "description": "Therapeutic areas and disease states for pharmaceutical expertise",
      "estimatedRows": 30,
      "columns": 10,
      "indexes": 2,
      "junctionTables": ["role_therapeutic_areas"],
      "pharmaSpecific": true
    },
    {
      "name": "stakeholder_types",
      "type": "reference",
      "category": "pharma_enrichment",
      "description": "Types of stakeholders pharmaceutical roles interact with",
      "estimatedRows": 40,
      "columns": 9,
      "indexes": 2,
      "junctionTables": ["role_stakeholder_interactions"],
      "pharmaSpecific": false
    },
    {
      "name": "career_paths",
      "type": "reference",
      "category": "pharma_enrichment",
      "description": "Career progression pathways within pharmaceutical organizations",
      "estimatedRows": 20,
      "columns": 7,
      "indexes": 1,
      "junctionTables": ["role_career_paths"],
      "pharmaSpecific": false
    }
  ],
  "proposedJunctionTables": [
    {
      "name": "role_skills",
      "links": ["org_roles", "skills"],
      "additionalColumns": 5,
      "purpose": "Many-to-many relationship between roles and skills with proficiency"
    },
    {
      "name": "role_certifications",
      "links": ["org_roles", "certifications"],
      "additionalColumns": 4,
      "purpose": "Required certifications per role"
    },
    {
      "name": "role_competencies",
      "links": ["org_roles", "competencies"],
      "additionalColumns": 3,
      "purpose": "Core competencies required for role success"
    },
    {
      "name": "role_kpis",
      "links": ["org_roles", "kpis"],
      "additionalColumns": 4,
      "purpose": "KPIs used to measure role performance"
    },
    {
      "name": "role_training_programs",
      "links": ["org_roles", "training_programs"],
      "additionalColumns": 3,
      "purpose": "Training programs required for role"
    },
    {
      "name": "role_regulatory_requirements",
      "links": ["org_roles", "regulatory_requirements"],
      "additionalColumns": 3,
      "purpose": "Regulatory requirements applicable to role"
    },
    {
      "name": "role_systems",
      "links": ["org_roles", "systems"],
      "additionalColumns": 4,
      "purpose": "Systems and software used in role"
    },
    {
      "name": "role_deliverables",
      "links": ["org_roles", "deliverables"],
      "additionalColumns": 3,
      "purpose": "Key deliverables produced by role"
    },
    {
      "name": "role_therapeutic_areas",
      "links": ["org_roles", "therapeutic_areas"],
      "additionalColumns": 2,
      "purpose": "Therapeutic areas of expertise for role"
    },
    {
      "name": "role_stakeholder_interactions",
      "links": ["org_roles", "stakeholder_types"],
      "additionalColumns": 3,
      "purpose": "Stakeholders role interacts with"
    },
    {
      "name": "role_career_paths",
      "links": ["org_roles", "org_roles", "career_paths"],
      "additionalColumns": 3,
      "purpose": "Career progression pathways from role to role"
    }
  ],
  "metrics": {
    "existingTables": 26,
    "existingJunctionTables": 13,
    "proposedNewTables": 11,
    "proposedNewJunctionTables": 11,
    "newColumnsInOrgRoles": 15,
    "deprecatedColumns": 2,
    "totalIndexes": 37,
    "estimatedStorageImpact": "100MB",
    "pharmaSpecificTables": 8
  },
  "namingConventions": {
    "tables": "lowercase_with_underscores",
    "referenceTablePrefix": "none (e.g., skills, goals)",
    "orgTablePrefix": "org_ (e.g., org_roles, org_functions)",
    "junctionTables": "{table1}_{table2}",
    "columns": "lowercase_with_underscores",
    "primaryKey": "id UUID DEFAULT uuid_generate_v4()",
    "foreignKey": "{table}_id UUID REFERENCES {table}(id)",
    "booleanFlags": "is_{adjective} or {verb}_ready",
    "timestamps": "created_at, updated_at",
    "audit": "created_by, updated_by",
    "arrays": "{plural_name} TEXT[]",
    "enums": "CHECK ({column} IN (...))",
    "indexes": "idx_{table}_{column(s)}"
  },
  "migrationStrategy": {
    "phases": [
      {
        "phase": 1,
        "name": "Core Reference Tables",
        "migrationFile": "20251122000001_pharma_roles_reference_tables.sql",
        "description": "Create all 11 new reference tables with indexes and triggers",
        "risk": "low"
      },
      {
        "phase": 2,
        "name": "Junction Tables",
        "migrationFile": "20251122000002_pharma_roles_junction_tables.sql",
        "description": "Create all 11 new junction tables with indexes",
        "risk": "low"
      },
      {
        "phase": 3,
        "name": "Extend org_roles",
        "migrationFile": "20251122000003_pharma_roles_extend_org_roles.sql",
        "description": "Add 15 new columns to org_roles table",
        "risk": "low"
      },
      {
        "phase": 4,
        "name": "Migrate Array Data",
        "migrationFile": "20251122000004_pharma_roles_migrate_array_data.sql",
        "description": "Migrate required_skills and required_certifications from arrays to junction tables",
        "risk": "medium",
        "rollbackRequired": true
      },
      {
        "phase": 5,
        "name": "Seed Core Data",
        "migrationFile": "20251122000005_pharma_roles_seed_core_data.sql",
        "description": "Load initial pharma-specific reference data",
        "risk": "low"
      }
    ]
  },
  "validationChecklist": {
    "preMigration": [
      "Review all table names for conflicts",
      "Verify foreign key references exist",
      "Check constraint values are realistic",
      "Validate index strategy",
      "Review RLS policies",
      "Test on development database",
      "Generate TypeScript types",
      "Update API documentation"
    ],
    "postMigration": [
      "Verify all tables created successfully",
      "Check all indexes exist",
      "Validate triggers are working",
      "Test RLS policies",
      "Run sample queries",
      "Load seed data",
      "Verify application integration",
      "Performance test junction table queries",
      "Validate full-text search",
      "Check tenant isolation"
    ]
  },
  "conflicts": [
    {
      "type": "array_column",
      "table": "org_roles",
      "column": "required_skills",
      "resolution": "Migrate to role_skills junction table, then deprecate",
      "status": "planned"
    },
    {
      "type": "array_column",
      "table": "org_roles",
      "column": "required_certifications",
      "resolution": "Migrate to role_certifications junction table, then deprecate",
      "status": "planned"
    }
  ],
  "integrationPoints": {
    "existingSchema": [
      {
        "table": "personas",
        "relationship": "personas.role_id -> org_roles.id",
        "impact": "none"
      },
      {
        "table": "agents",
        "relationship": "agents can leverage role expertise data",
        "impact": "enhancement"
      },
      {
        "table": "jtbd_core",
        "relationship": "roles can be linked to specific JTBDs",
        "impact": "future"
      }
    ],
    "externalSystems": [
      "HRIS (Workday, SuccessFactors)",
      "Learning Management Systems",
      "Performance Management Systems",
      "Talent Acquisition Systems"
    ]
  },
  "performanceEstimates": {
    "storage": {
      "referenceTables": "50MB",
      "junctionTables": "10KB initial",
      "indexes": "30% overhead",
      "total": "~100MB initial"
    },
    "queryPerformance": {
      "simpleRoleLookup": "<10ms",
      "fullRoleProfile": "<50ms",
      "complexAnalytics": "<200ms",
      "fullTextSearch": "<100ms"
    },
    "scalability": {
      "rolesPerTenant": "500-2000",
      "globalSkills": "~500",
      "junctionRecordsPerTenant": "50K-500K",
      "maxJunctionRecords": "10M (performant)"
    }
  }
}
