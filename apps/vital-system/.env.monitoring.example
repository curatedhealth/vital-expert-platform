# RAG Monitoring Configuration
# Copy these values to your .env file to enable budget tracking and alerts

# ============================================================================
# Budget Configuration
# ============================================================================

# Daily budget limit in USD (default: $10/day)
RAG_DAILY_BUDGET_USD=10

# Monthly budget limit in USD (default: $300/month)
RAG_MONTHLY_BUDGET_USD=300

# Per-query budget limit in USD (default: $0.10)
RAG_PER_QUERY_BUDGET_USD=0.10

# Alert when budget reaches this percentage (default: 80%)
# Alerts trigger when daily/monthly usage exceeds this threshold
RAG_BUDGET_ALERT_THRESHOLD=80

# ============================================================================
# Circuit Breaker Configuration (Optional - using defaults)
# ============================================================================

# Number of consecutive failures before opening circuit (default: 5)
# CIRCUIT_BREAKER_FAILURE_THRESHOLD=5

# Number of consecutive successes to close circuit (default: 2)
# CIRCUIT_BREAKER_SUCCESS_THRESHOLD=2

# Timeout in milliseconds before attempting to close circuit (default: 60000 = 1 minute)
# CIRCUIT_BREAKER_TIMEOUT_MS=60000

# Time window for tracking failures in milliseconds (default: 120000 = 2 minutes)
# CIRCUIT_BREAKER_MONITORING_PERIOD_MS=120000

# ============================================================================
# Latency Alert Configuration (Optional - using defaults)
# ============================================================================

# Maximum P95 latency in milliseconds (default: 2000ms = 2 seconds)
# RAG_LATENCY_P95_MAX_MS=2000

# Maximum P99 latency in milliseconds (default: 5000ms = 5 seconds)
# RAG_LATENCY_P99_MAX_MS=5000

# Minimum cache hit rate (default: 0.5 = 50%)
# RAG_CACHE_HIT_RATE_MIN=0.5

# ============================================================================
# Cost Estimation Configuration (Reference Only)
# ============================================================================
# These pricing values are built into the cost tracker.
# Update rag-cost-tracker.ts if pricing changes.

# OpenAI Pricing (Jan 2025):
# - text-embedding-3-large: $0.13 per 1M tokens
# - text-embedding-3-small: $0.02 per 1M tokens
# - gpt-4-turbo-preview: $10/$30 per 1M tokens (input/output)
# - gpt-3.5-turbo: $0.50/$1.50 per 1M tokens (input/output)

# Pinecone Pricing (Serverless, Jan 2025):
# - Read units: $0.40 per 1M
# - Write units: $2.00 per 1M

# Cohere Pricing (Jan 2025):
# - Rerank: $2 per 1M search units

# Google AI Pricing (approximate):
# - Entity extraction: ~$0.01 per 1K tokens

# ============================================================================
# Example Budget Scenarios
# ============================================================================

# Startup / Development (Low Volume: ~100 queries/day):
# RAG_DAILY_BUDGET_USD=2
# RAG_MONTHLY_BUDGET_USD=60
# RAG_PER_QUERY_BUDGET_USD=0.02
# Expected cost: ~$1-2/day = $30-60/month

# Small Business (Medium Volume: ~500 queries/day):
# RAG_DAILY_BUDGET_USD=10
# RAG_MONTHLY_BUDGET_USD=300
# RAG_PER_QUERY_BUDGET_USD=0.05
# Expected cost: ~$5-10/day = $150-300/month

# Enterprise (High Volume: ~2000 queries/day):
# RAG_DAILY_BUDGET_USD=50
# RAG_MONTHLY_BUDGET_USD=1500
# RAG_PER_QUERY_BUDGET_USD=0.10
# Expected cost: ~$20-50/day = $600-1500/month

# ============================================================================
# Cost Optimization Tips
# ============================================================================

# 1. Enable caching (already enabled in your system):
#    - 70-80% cache hit rate can save $0.007 per cached query
#    - With 500 queries/day, 70% cached = $2.45/day savings = $73.50/month

# 2. Use text-embedding-3-small for non-critical queries:
#    - 85% cheaper than text-embedding-3-large
#    - Reduces embedding cost from $0.0013 to $0.0002 per 100 tokens

# 3. Reduce re-ranking frequency:
#    - Re-ranking adds ~$0.00001 per query
#    - Use only for critical queries or user-facing searches

# 4. Optimize chunk sizes:
#    - Larger chunks reduce number of chunks, lowering vector storage costs
#    - Smaller chunks improve precision but increase costs

# 5. Monitor expensive queries:
#    - Use /api/rag-metrics?endpoint=cost to find expensive queries
#    - Optimize or cache frequent expensive queries

# ============================================================================
# Monitoring API Endpoints
# ============================================================================

# Dashboard (all metrics):
# GET http://localhost:3000/api/rag-metrics?endpoint=dashboard&window=60

# Latency metrics:
# GET http://localhost:3000/api/rag-metrics?endpoint=latency&window=60

# Cost metrics:
# GET http://localhost:3000/api/rag-metrics?endpoint=cost&window=60

# Service health:
# GET http://localhost:3000/api/rag-metrics?endpoint=health

# Real-time metrics (last 5 min):
# GET http://localhost:3000/api/rag-metrics?endpoint=realtime

# SLO compliance:
# GET http://localhost:3000/api/rag-metrics?endpoint=slo&window=60

# Export data for analysis:
# GET http://localhost:3000/api/rag-metrics?endpoint=export&window=1440

# Console format (CLI-friendly):
# GET http://localhost:3000/api/rag-metrics?endpoint=dashboard&format=console

# Reset circuit breakers (emergency):
# POST http://localhost:3000/api/rag-metrics
# Body: {"serviceName": "openai"} or {} for all

# ============================================================================
# Quick Start Commands
# ============================================================================

# View dashboard:
# curl "http://localhost:3000/api/rag-metrics?endpoint=dashboard&format=console"

# Monitor real-time:
# watch -n 5 'curl -s "http://localhost:3000/api/rag-metrics?endpoint=realtime" | jq'

# Check latency:
# curl "http://localhost:3000/api/rag-metrics?endpoint=latency&window=60" | jq '.overall.total'

# Check costs:
# curl "http://localhost:3000/api/rag-metrics?endpoint=cost&window=60" | jq '.stats'

# Check health:
# curl "http://localhost:3000/api/rag-metrics?endpoint=health" | jq

# ============================================================================
# Notes
# ============================================================================

# - All budget limits are per-tenant if you have multi-tenant setup
# - Alerts are logged to console, integrate with Slack/PagerDuty in Phase 2
# - Metrics are stored in-memory (last 10K latency, 100K cost entries)
# - For long-term storage, export to TimescaleDB (Phase 2)
# - Circuit breakers prevent cascading failures (automatic recovery)
# - Cost tracking has <5% overhead (negligible performance impact)
