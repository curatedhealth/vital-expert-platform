{
  "dashboard": {
    "title": "VITAL Platform Overview",
    "tags": ["vital", "overview", "production"],
    "timezone": "browser",
    "schemaVersion": 38,
    "version": 1,
    "refresh": "30s",
    "time": {
      "from": "now-24h",
      "to": "now"
    },
    "panels": [
      {
        "id": 1,
        "title": "Search Performance",
        "type": "graph",
        "gridPos": { "x": 0, "y": 0, "w": 12, "h": 8 },
        "targets": [
          {
            "refId": "A",
            "datasource": "PostgreSQL",
            "rawSql": "SELECT occurred_at as time, (metadata->>'search_time_ms')::float as value FROM compliance_audit_log WHERE event_type = 'access' AND action = 'search' AND occurred_at > NOW() - INTERVAL '24 hours' ORDER BY occurred_at",
            "format": "time_series"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "ms",
            "color": { "mode": "palette-classic" },
            "custom": {
              "lineWidth": 2,
              "fillOpacity": 10
            }
          }
        },
        "options": {
          "tooltip": { "mode": "multi" },
          "legend": { "displayMode": "list", "placement": "bottom" }
        }
      },
      {
        "id": 2,
        "title": "Evidence Detection Rate",
        "type": "stat",
        "gridPos": { "x": 12, "y": 0, "w": 6, "h": 4 },
        "targets": [
          {
            "refId": "A",
            "datasource": "PostgreSQL",
            "rawSql": "SELECT COUNT(*) as value FROM compliance_audit_log WHERE event_type = 'compliance_check' AND action = 'evidence_detected' AND occurred_at > NOW() - INTERVAL '1 hour'",
            "format": "table"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "color": { "mode": "thresholds" },
            "thresholds": {
              "mode": "absolute",
              "steps": [
                { "value": 0, "color": "red" },
                { "value": 10, "color": "yellow" },
                { "value": 50, "color": "green" }
              ]
            }
          }
        }
      },
      {
        "id": 3,
        "title": "Active Sessions",
        "type": "stat",
        "gridPos": { "x": 18, "y": 0, "w": 6, "h": 4 },
        "targets": [
          {
            "refId": "A",
            "datasource": "PostgreSQL",
            "rawSql": "SELECT COUNT(*) as value FROM user_sessions WHERE is_active = TRUE AND expires_at > NOW()",
            "format": "table"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "color": { "mode": "thresholds" },
            "thresholds": {
              "mode": "absolute",
              "steps": [
                { "value": 0, "color": "blue" },
                { "value": 100, "color": "green" },
                { "value": 500, "color": "yellow" },
                { "value": 1000, "color": "red" }
              ]
            }
          }
        }
      },
      {
        "id": 4,
        "title": "HITL Review Queue",
        "type": "stat",
        "gridPos": { "x": 12, "y": 4, "w": 6, "h": 4 },
        "targets": [
          {
            "refId": "A",
            "datasource": "PostgreSQL",
            "rawSql": "SELECT COUNT(*) as value FROM review_queue WHERE status = 'pending' AND sla_breached = FALSE",
            "format": "table"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "color": { "mode": "thresholds" },
            "thresholds": {
              "mode": "absolute",
              "steps": [
                { "value": 0, "color": "green" },
                { "value": 5, "color": "yellow" },
                { "value": 20, "color": "red" }
              ]
            }
          }
        },
        "options": {
          "textMode": "value_and_name",
          "graphMode": "none"
        }
      },
      {
        "id": 5,
        "title": "SLA Breaches",
        "type": "stat",
        "gridPos": { "x": 18, "y": 4, "w": 6, "h": 4 },
        "targets": [
          {
            "refId": "A",
            "datasource": "PostgreSQL",
            "rawSql": "SELECT COUNT(*) as value FROM review_queue WHERE sla_breached = TRUE AND status NOT IN ('approved', 'rejected')",
            "format": "table"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "color": { "mode": "fixed", "fixedColor": "red" }
          }
        },
        "options": {
          "textMode": "value",
          "graphMode": "area",
          "colorMode": "background"
        }
      },
      {
        "id": 6,
        "title": "Risk Level Distribution (24h)",
        "type": "piechart",
        "gridPos": { "x": 0, "y": 8, "w": 8, "h": 8 },
        "targets": [
          {
            "refId": "A",
            "datasource": "PostgreSQL",
            "rawSql": "SELECT risk_level as metric, COUNT(*) as value FROM risk_assessments WHERE assessed_at > NOW() - INTERVAL '24 hours' GROUP BY risk_level ORDER BY CASE risk_level WHEN 'critical' THEN 1 WHEN 'high' THEN 2 WHEN 'medium' THEN 3 WHEN 'low' THEN 4 WHEN 'minimal' THEN 5 END",
            "format": "table"
          }
        ],
        "options": {
          "legend": { "displayMode": "table", "placement": "right" },
          "pieType": "donut"
        },
        "fieldConfig": {
          "overrides": [
            { "matcher": { "id": "byName", "options": "critical" }, "properties": [{ "id": "color", "value": { "fixedColor": "red", "mode": "fixed" } }] },
            { "matcher": { "id": "byName", "options": "high" }, "properties": [{ "id": "color", "value": { "fixedColor": "orange", "mode": "fixed" } }] },
            { "matcher": { "id": "byName", "options": "medium" }, "properties": [{ "id": "color", "value": { "fixedColor": "yellow", "mode": "fixed" } }] },
            { "matcher": { "id": "byName", "options": "low" }, "properties": [{ "id": "color", "value": { "fixedColor": "blue", "mode": "fixed" } }] },
            { "matcher": { "id": "byName", "options": "minimal" }, "properties": [{ "id": "color", "value": { "fixedColor": "green", "mode": "fixed" } }] }
          ]
        }
      },
      {
        "id": 7,
        "title": "Compliance Framework Coverage",
        "type": "bargauge",
        "gridPos": { "x": 8, "y": 8, "w": 8, "h": 8 },
        "targets": [
          {
            "refId": "A",
            "datasource": "PostgreSQL",
            "rawSql": "SELECT cf.code as metric, COUNT(acm.id) as value FROM compliance_frameworks cf LEFT JOIN agent_compliance_mappings acm ON acm.framework_id = cf.id AND acm.compliance_status = 'compliant' WHERE cf.is_active = TRUE GROUP BY cf.code ORDER BY value DESC",
            "format": "table"
          }
        ],
        "options": {
          "orientation": "horizontal",
          "displayMode": "gradient",
          "showUnfilled": true
        },
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "max": 250,
            "color": { "mode": "continuous-GrYlRd" }
          }
        }
      },
      {
        "id": 8,
        "title": "Top Agents by Usage",
        "type": "table",
        "gridPos": { "x": 16, "y": 8, "w": 8, "h": 8 },
        "targets": [
          {
            "refId": "A",
            "datasource": "PostgreSQL",
            "rawSql": "SELECT a.name, COUNT(cal.id) as interactions, AVG((cal.metadata->>'duration_ms')::float) as avg_duration FROM compliance_audit_log cal JOIN agents a ON a.id = cal.agent_id WHERE cal.occurred_at > NOW() - INTERVAL '24 hours' AND cal.event_type = 'access' GROUP BY a.name ORDER BY interactions DESC LIMIT 10",
            "format": "table"
          }
        ],
        "options": {
          "showHeader": true,
          "sortBy": [{ "displayName": "interactions", "desc": true }]
        },
        "fieldConfig": {
          "overrides": [
            { "matcher": { "id": "byName", "options": "avg_duration" }, "properties": [{ "id": "unit", "value": "ms" }] }
          ]
        }
      },
      {
        "id": 9,
        "title": "Search Query Volume",
        "type": "graph",
        "gridPos": { "x": 0, "y": 16, "w": 12, "h": 6 },
        "targets": [
          {
            "refId": "A",
            "datasource": "PostgreSQL",
            "rawSql": "SELECT DATE_TRUNC('minute', created_at) as time, COUNT(*) as value FROM search_history WHERE created_at > NOW() - INTERVAL '24 hours' GROUP BY time ORDER BY time",
            "format": "time_series"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "color": { "mode": "palette-classic" }
          }
        },
        "options": {
          "tooltip": { "mode": "multi" },
          "legend": { "displayMode": "list", "placement": "bottom" }
        }
      },
      {
        "id": 10,
        "title": "Evidence Quality Distribution",
        "type": "piechart",
        "gridPos": { "x": 12, "y": 16, "w": 6, "h": 6 },
        "targets": [
          {
            "refId": "A",
            "datasource": "PostgreSQL",
            "rawSql": "SELECT (metadata->>'evidence_quality')::text as metric, COUNT(*) as value FROM compliance_audit_log WHERE event_type = 'compliance_check' AND metadata ? 'evidence_quality' AND occurred_at > NOW() - INTERVAL '24 hours' GROUP BY metric",
            "format": "table"
          }
        ],
        "options": {
          "legend": { "displayMode": "list", "placement": "right" },
          "pieType": "pie"
        }
      },
      {
        "id": 11,
        "title": "Multi-Domain Evidence (24h)",
        "type": "stat",
        "gridPos": { "x": 18, "y": 16, "w": 6, "h": 6 },
        "targets": [
          {
            "refId": "A",
            "datasource": "PostgreSQL",
            "rawSql": "SELECT (metadata->>'domain')::text as metric, COUNT(*) as value FROM compliance_audit_log WHERE event_type = 'compliance_check' AND action = 'evidence_detected' AND metadata ? 'domain' AND occurred_at > NOW() - INTERVAL '24 hours' GROUP BY metric ORDER BY value DESC",
            "format": "table"
          }
        ],
        "options": {
          "textMode": "value_and_name",
          "graphMode": "area",
          "orientation": "auto"
        }
      },
      {
        "id": 12,
        "title": "Recommendation Click-Through Rate",
        "type": "graph",
        "gridPos": { "x": 0, "y": 22, "w": 12, "h": 6 },
        "targets": [
          {
            "refId": "A",
            "datasource": "PostgreSQL",
            "rawSql": "SELECT DATE_TRUNC('hour', created_at) as time, ROUND(100.0 * COUNT(*) FILTER (WHERE clicked = TRUE) / NULLIF(COUNT(*), 0), 2) as value FROM personalized_recommendations WHERE created_at > NOW() - INTERVAL '24 hours' AND shown = TRUE GROUP BY time ORDER BY time",
            "format": "time_series"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "max": 100,
            "color": { "mode": "palette-classic" }
          }
        }
      },
      {
        "id": 13,
        "title": "Compliance Violations (7 days)",
        "type": "table",
        "gridPos": { "x": 12, "y": 22, "w": 12, "h": 6 },
        "targets": [
          {
            "refId": "A",
            "datasource": "PostgreSQL",
            "rawSql": "SELECT compliance_tags->>0 as framework, event_category, COUNT(*) as violation_count, MAX(occurred_at) as last_violation FROM compliance_audit_log WHERE compliant = FALSE AND occurred_at > NOW() - INTERVAL '7 days' GROUP BY framework, event_category ORDER BY violation_count DESC LIMIT 20",
            "format": "table"
          }
        ],
        "options": {
          "showHeader": true,
          "sortBy": [{ "displayName": "violation_count", "desc": true }]
        }
      },
      {
        "id": 14,
        "title": "Average Review Time by Risk Level",
        "type": "bargauge",
        "gridPos": { "x": 0, "y": 28, "w": 12, "h": 6 },
        "targets": [
          {
            "refId": "A",
            "datasource": "PostgreSQL",
            "rawSql": "SELECT ra.risk_level as metric, AVG(EXTRACT(EPOCH FROM (rq.reviewed_at - rq.created_at))) / 60 as value FROM review_queue rq JOIN risk_assessments ra ON ra.id = rq.risk_assessment_id WHERE rq.reviewed_at IS NOT NULL AND rq.created_at > NOW() - INTERVAL '7 days' GROUP BY ra.risk_level ORDER BY CASE ra.risk_level WHEN 'critical' THEN 1 WHEN 'high' THEN 2 WHEN 'medium' THEN 3 WHEN 'low' THEN 4 WHEN 'minimal' THEN 5 END",
            "format": "table"
          }
        ],
        "options": {
          "orientation": "horizontal",
          "displayMode": "gradient"
        },
        "fieldConfig": {
          "defaults": {
            "unit": "m",
            "color": { "mode": "continuous-RdYlGr", "reverse": true }
          }
        }
      },
      {
        "id": 15,
        "title": "Cache Hit Rate",
        "type": "stat",
        "gridPos": { "x": 12, "y": 28, "w": 6, "h": 6 },
        "targets": [
          {
            "refId": "A",
            "datasource": "PostgreSQL",
            "rawSql": "SELECT ROUND(100.0 * COUNT(*) FILTER (WHERE (metadata->>'cache_hit')::boolean = TRUE) / NULLIF(COUNT(*), 0), 2) as value FROM compliance_audit_log WHERE event_type = 'access' AND action = 'search' AND occurred_at > NOW() - INTERVAL '1 hour'",
            "format": "table"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "max": 100,
            "color": { "mode": "thresholds" },
            "thresholds": {
              "mode": "absolute",
              "steps": [
                { "value": 0, "color": "red" },
                { "value": 50, "color": "yellow" },
                { "value": 75, "color": "green" }
              ]
            }
          }
        },
        "options": {
          "textMode": "value_and_name",
          "graphMode": "area",
          "colorMode": "background"
        }
      },
      {
        "id": 16,
        "title": "P90 Latency by Operation",
        "type": "table",
        "gridPos": { "x": 18, "y": 28, "w": 6, "h": 6 },
        "targets": [
          {
            "refId": "A",
            "datasource": "PostgreSQL",
            "rawSql": "SELECT action as operation, PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY (metadata->>'duration_ms')::float) as p90_ms FROM compliance_audit_log WHERE metadata ? 'duration_ms' AND occurred_at > NOW() - INTERVAL '1 hour' GROUP BY action ORDER BY p90_ms DESC",
            "format": "table"
          }
        ],
        "options": {
          "showHeader": true
        },
        "fieldConfig": {
          "overrides": [
            { "matcher": { "id": "byName", "options": "p90_ms" }, "properties": [{ "id": "unit", "value": "ms" }] }
          ]
        }
      }
    ]
  }
}
