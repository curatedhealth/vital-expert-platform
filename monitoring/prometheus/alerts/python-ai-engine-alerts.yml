# Python AI Engine Alert Rules
# Alerts for FastAPI backend service

groups:
  - name: python_ai_engine
    interval: 30s
    rules:
      # High error rate
      - alert: PythonAIEngineHighErrorRate
        expr: rate(vital_ai_requests_total{status=~"5.."}[5m]) > 0.1
        for: 5m
        labels:
          severity: critical
          service: python-ai-engine
        annotations:
          summary: "Python AI Engine has high error rate"
          description: "Error rate is {{ $value }} errors/sec (threshold: 0.1)"

      # High request latency
      - alert: PythonAIEngineHighLatency
        expr: histogram_quantile(0.95, rate(vital_ai_request_duration_seconds_bucket[5m])) > 5
        for: 10m
        labels:
          severity: warning
          service: python-ai-engine
        annotations:
          summary: "Python AI Engine has high request latency"
          description: "P95 latency is {{ $value }} seconds (threshold: 5s)"

      # High RAG query latency
      - alert: PythonAIEngineHighRAGLatency
        expr: histogram_quantile(0.95, rate(vital_ai_rag_query_duration_seconds_bucket[5m])) > 10
        for: 10m
        labels:
          severity: warning
          service: python-ai-engine
        annotations:
          summary: "Python AI Engine RAG queries are slow"
          description: "P95 RAG query latency is {{ $value }} seconds (threshold: 10s)"

      # Service unavailable
      - alert: PythonAIEngineDown
        expr: up{job="vital-python-ai-engine"} == 0
        for: 2m
        labels:
          severity: critical
          service: python-ai-engine
        annotations:
          summary: "Python AI Engine is down"
          description: "Python AI Engine has been down for more than 2 minutes"

      # High database connection count
      - alert: PythonAIEngineHighDBConnections
        expr: vital_ai_database_connections > 50
        for: 5m
        labels:
          severity: warning
          service: python-ai-engine
        annotations:
          summary: "Python AI Engine has high database connections"
          description: "Database connections: {{ $value }} (threshold: 50)"

      # High vector search latency
      - alert: PythonAIEngineHighVectorSearchLatency
        expr: histogram_quantile(0.95, rate(vital_ai_vector_search_duration_seconds_bucket[5m])) > 3
        for: 10m
        labels:
          severity: warning
          service: python-ai-engine
        annotations:
          summary: "Python AI Engine vector searches are slow"
          description: "P95 vector search latency is {{ $value }} seconds (threshold: 3s)"

