{
  "$schema": "https://json-schema.org/draft-07/schema",
  "title": "VITAL Platform - Persona Data Model v5.0",
  "description": "Normalized persona data structure compliant with DATABASE_SCHEMA_AND_DATA_GOLDEN_RULES.md",
  "version": "5.0.0",
  "last_updated": "2025-11-17",

  "golden_rules": {
    "rule_1": "NO JSONB columns for structured data - use normalized tables",
    "rule_2": "Full normalization to 3NF minimum",
    "rule_3": "TEXT[] only for simple string lists (no metadata)",
    "note": "This template ensures Golden Rules compliance"
  },

  "personas": [
    {
      "_comment": "=== CORE PROFILE (Required) ===",
      "core_profile": {
        "name": {
          "type": "text",
          "required": true,
          "example": "Dr. Sarah Chen"
        },
        "slug": {
          "type": "text",
          "required": true,
          "unique": true,
          "example": "dr-sarah-chen-medical-director",
          "note": "URL-friendly identifier"
        },
        "title": {
          "type": "text",
          "required": true,
          "example": "Medical Director, Oncology"
        },
        "department": {
          "type": "text",
          "required": false,
          "example": "Medical Affairs"
        },
        "industry": {
          "type": "text",
          "required": false,
          "example": "Pharmaceutical"
        },
        "company_size": {
          "type": "enum",
          "required": false,
          "values": ["startup", "small", "medium", "large", "enterprise"],
          "example": "large"
        },
        "years_of_experience": {
          "type": "integer",
          "required": false,
          "example": 15
        },
        "education_level": {
          "type": "text",
          "required": false,
          "example": "MD, PhD"
        }
      },

      "_comment": "=== DEMOGRAPHICS (Normalized Table) ===",
      "demographics": {
        "age_range": {
          "type": "text",
          "required": false,
          "example": "40-50"
        },
        "location": {
          "type": "text",
          "required": false,
          "example": "Boston, MA"
        },
        "work_environment": {
          "type": "enum",
          "required": false,
          "values": ["remote", "hybrid", "onsite"],
          "example": "hybrid"
        }
      },

      "_comment": "=== PAIN POINTS (Normalized Table: persona_pain_points) ===",
      "_note_pain_points": "Previously JSONB, now normalized. Each becomes a row in persona_pain_points table",
      "pain_points": [
        {
          "pain_point": {
            "type": "text",
            "required": true,
            "maps_to": "pain_point_text",
            "example": "Managing multiple concurrent clinical trials"
          },
          "description": {
            "type": "text",
            "required": false,
            "maps_to": "pain_description",
            "example": "Coordination across teams and stakeholders is time-consuming"
          },
          "category": {
            "type": "enum",
            "required": true,
            "maps_to": "pain_category",
            "values": ["operational", "strategic", "technology", "interpersonal"],
            "example": "operational"
          },
          "severity": {
            "type": "enum",
            "required": true,
            "values": ["critical", "high", "medium", "low"],
            "example": "high"
          }
        }
      ],

      "_comment": "=== GOALS (Normalized Table: persona_goals) ===",
      "_note_goals": "Previously JSONB, now normalized. Each becomes a row in persona_goals table",
      "goals": [
        {
          "goal": {
            "type": "text",
            "required": true,
            "maps_to": "goal_text",
            "example": "Accelerate patient enrollment in clinical trials"
          },
          "type": {
            "type": "enum",
            "required": true,
            "maps_to": "goal_type",
            "values": ["primary", "secondary", "long_term", "personal"],
            "example": "primary"
          },
          "priority": {
            "type": "integer OR string",
            "required": false,
            "note": "Accepts numeric (1, 2, 3) or string ('high', 'medium', 'low')",
            "example": "high"
          }
        }
      ],

      "_comment": "=== CHALLENGES (Normalized Table: persona_challenges) ===",
      "_note_challenges": "Previously JSONB, now normalized. Each becomes a row in persona_challenges table",
      "challenges": [
        {
          "challenge": {
            "type": "text",
            "required": true,
            "maps_to": "challenge_text",
            "example": "Keeping up with evolving regulations"
          },
          "description": {
            "type": "text",
            "required": false,
            "maps_to": "challenge_description",
            "example": "Regulatory landscape changes frequently across markets"
          },
          "type": {
            "type": "enum",
            "required": true,
            "maps_to": "challenge_type",
            "values": ["daily", "weekly", "strategic", "external"],
            "example": "strategic"
          },
          "impact": {
            "type": "enum",
            "required": true,
            "maps_to": "impact_level",
            "values": ["critical", "high", "medium", "low"],
            "example": "high"
          }
        }
      ],

      "_comment": "=== COMMUNICATION PREFERENCES (Normalized Table: persona_communication_preferences) ===",
      "_note_comm_prefs": "Previously JSONB, now normalized. Can be object or array",
      "communication_preferences": {
        "preferred_channels": {
          "type": "text",
          "maps_to": "preference_value with preference_type='channel'",
          "example": "Email, Teams, Slack"
        },
        "frequency": {
          "type": "text",
          "maps_to": "preference_value with preference_type='frequency'",
          "example": "Daily updates preferred"
        },
        "meeting_style": {
          "type": "text",
          "maps_to": "preference_value with preference_type='meeting_style'",
          "example": "Prefers structured agendas"
        }
      },

      "_comment": "=== EVIDENCE SUMMARY (Normalized Table: persona_evidence_summary) ===",
      "evidence_summary": {
        "total_sources": {
          "type": "integer",
          "required": false,
          "default": 0,
          "example": 25
        },
        "research_count": {
          "type": "integer",
          "required": false,
          "maps_to": "research_studies_count",
          "example": 8
        },
        "reports_count": {
          "type": "integer",
          "required": false,
          "maps_to": "industry_reports_count",
          "example": 6
        },
        "opinions_count": {
          "type": "integer",
          "required": false,
          "maps_to": "expert_opinions_count",
          "example": 5
        },
        "case_studies_count": {
          "type": "integer",
          "required": false,
          "default": 0,
          "example": 3
        },
        "statistics_count": {
          "type": "integer",
          "required": false,
          "default": 0,
          "example": 10
        },
        "overall_confidence_level": {
          "type": "enum",
          "required": true,
          "default": "medium",
          "values": ["very_high", "high", "medium", "low", "very_low"],
          "example": "very_high"
        },
        "evidence_quality_score": {
          "type": "integer",
          "required": true,
          "default": 7,
          "range": "1-10",
          "example": 9
        },
        "evidence_recency_score": {
          "type": "integer",
          "required": false,
          "default": 7,
          "range": "1-10",
          "example": 8
        }
      },

      "_comment": "=== CASE STUDIES (Normalized Table: persona_case_studies) ===",
      "case_studies": [
        {
          "case_study_title": {
            "type": "text",
            "required": true,
            "example": "Successful Launch of Novel Immunotherapy"
          },
          "organization_name": {
            "type": "text",
            "required": false,
            "default": "Organization",
            "example": "Leading Pharma Company"
          },
          "industry": {
            "type": "text",
            "required": false,
            "default": "Healthcare",
            "example": "Healthcare"
          },
          "case_type": {
            "type": "enum",
            "required": false,
            "default": "success_story",
            "values": ["success_story", "failure", "lessons_learned", "best_practice"],
            "example": "success_story"
          },
          "challenge_addressed": {
            "type": "text",
            "required": true,
            "example": "Launch product in highly competitive oncology market"
          },
          "solution_implemented": {
            "type": "text",
            "required": true,
            "example": "Comprehensive medical affairs strategy with KOL engagement"
          },
          "outcomes_achieved": {
            "type": "TEXT[]",
            "required": false,
            "note": "Simple string array - no metadata (Golden Rule #3)",
            "example": ["20% market share in year 1", "$500M revenue", "Strong HCP satisfaction"]
          },
          "relevance_to_persona": {
            "type": "text",
            "required": false,
            "default": "Relevant to role",
            "example": "Directly applicable to current launch challenges"
          },
          "relevance_score": {
            "type": "integer",
            "required": false,
            "default": 8,
            "range": "1-10",
            "example": 9
          }
        }
      ],

      "_comment": "=== MONTHLY OBJECTIVES (Normalized Table: persona_monthly_objectives) ===",
      "monthly_objectives": [
        {
          "objective_description": {
            "type": "text",
            "required": true,
            "maps_to": "objective_text",
            "example": "Complete Q4 clinical trial enrollment targets"
          },
          "success_criteria": {
            "type": "text",
            "required": false,
            "maps_to": "success_metric",
            "example": "Enroll 100+ patients by month end"
          },
          "achievement_rate": {
            "type": "numeric",
            "required": false,
            "note": "Decimal 0.0-1.0 OR percentage 0-100 (auto-converted)",
            "example": "0.85 OR 85"
          }
        }
      ],

      "_comment": "=== WEEK IN LIFE (Normalized Table: persona_week_in_life) ===",
      "week_in_life": [
        {
          "day_of_week": {
            "type": "enum",
            "required": true,
            "values": ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"],
            "example": "monday"
          },
          "activities": {
            "type": "TEXT[]",
            "required": false,
            "note": "Simple string array",
            "example": ["Team standup", "Review trial data", "KOL meetings"]
          },
          "focus_areas": {
            "type": "TEXT[]",
            "required": false,
            "example": ["Strategic planning", "Stakeholder communication"]
          },
          "meeting_load": {
            "type": "enum",
            "required": false,
            "values": ["heavy", "moderate", "light"],
            "example": "heavy"
          },
          "energy_pattern": {
            "type": "enum",
            "required": false,
            "values": ["high", "medium", "low"],
            "example": "high"
          },
          "typical_hours": {
            "type": "text",
            "required": false,
            "example": "8-10 hours"
          }
        }
      ],

      "_comment": "=== MONTH IN LIFE (Normalized Table: persona_month_in_life) ===",
      "month_in_life": [
        {
          "month_phase": {
            "type": "enum",
            "required": true,
            "unique_per_persona": true,
            "values": ["beginning", "mid", "end"],
            "example": "beginning",
            "note": "Only 3 phases allowed per persona"
          },
          "key_activities": {
            "type": "TEXT[]",
            "required": false,
            "example": ["Budget planning", "Team reviews"]
          },
          "priorities": {
            "type": "TEXT[]",
            "required": false,
            "example": ["Q1 objectives", "Resource allocation"]
          },
          "stress_level": {
            "type": "enum",
            "required": false,
            "values": ["very_high", "high", "medium", "low", "very_low"],
            "example": "medium"
          }
        }
      ],

      "_comment": "=== ANNUAL CONFERENCES (Normalized Table: persona_annual_conferences) ===",
      "annual_conferences": [
        {
          "conference_name": {
            "type": "text",
            "required": true,
            "example": "ASCO Annual Meeting"
          },
          "conference_type": {
            "type": "enum",
            "required": false,
            "values": ["technical", "industry", "leadership", "networking"],
            "example": "technical"
          },
          "role": {
            "type": "enum",
            "required": false,
            "values": ["attendee", "speaker", "organizer", "exhibitor"],
            "example": "speaker"
          },
          "importance": {
            "type": "enum",
            "required": false,
            "values": ["critical", "high", "medium", "low"],
            "example": "critical"
          }
        }
      ],

      "_comment": "=== ADDITIONAL v5.0 TABLES (Available but Optional) ===",
      "_available_tables": [
        "persona_expert_opinions",
        "persona_industry_reports",
        "persona_public_research",
        "persona_key_responsibilities",
        "persona_decision_making_process",
        "persona_technology_usage",
        "persona_success_metrics",
        "persona_professional_development",
        "persona_networking_habits",
        "persona_content_preferences"
      ]
    }
  ],

  "_metadata": {
    "schema_version": "5.0",
    "compliance": {
      "golden_rule_1": "COMPLIANT - No JSONB columns (except metadata for unstructured data)",
      "golden_rule_2": "COMPLIANT - Full 3NF normalization",
      "golden_rule_3": "COMPLIANT - TEXT[] only for simple lists"
    },
    "deployment_info": {
      "database": "Supabase PostgreSQL",
      "total_tables": 70,
      "jsonb_columns": 0,
      "normalized_relationships": "All FK constraints enforced"
    },
    "usage_notes": [
      "1. Each nested object/array maps to its own table",
      "2. All enum values must match CHECK constraints",
      "3. Priority fields accept both numeric and string values",
      "4. Achievement rates auto-convert percentages to decimals",
      "5. tenant_id is automatically set during deployment",
      "6. IDs (UUID) are auto-generated - do not provide"
    ],
    "transformation": {
      "script": "final_transform.py",
      "config_files": [
        "DEFAULT_VALUES.json - Provides defaults for required fields",
        "VALUE_MAPPINGS.json - Maps invalid enums to valid values"
      ]
    }
  }
}
